plugins {
	id "java"
	id "maven-publish"
}

repositories {
	mavenCentral()
}

dependencies {
	implementation "net.jodah:typetools:0.6.3"
	implementation "org.ow2.asm:asm:9.7.1"

	testImplementation "org.junit.jupiter:junit-jupiter:5.7.1"
	testRuntimeOnly "org.junit.platform:junit-platform-launcher"
}

tasks.named("test", Test) {
	useJUnitPlatform()
	maxHeapSize = "1G"
	testLogging {
		events "passed"
	}
}

publishing {
	repositories {
		maven {
			name = "Xanadu"
			url = "https://repo.xeromeda.com/${(System.getenv("VERSION") ?: "SNAPSHOT").contains("SNAPSHOT") ? "snapshots" : "releases"}"
			authentication {
				basic(BasicAuthentication)
			}
			credentials {
				username = System.getenv("MAVEN_NAME") ?: getProperty("XanaduUsername")
				password = System.getenv("MAVEN_SECRET") ?: getProperty("XanaduPassword")
			}
		}
	}
	publications {
		maven(MavenPublication) {
			groupId = "nl.appelgebakje22"
			artifactId = "eventbus"
			version = System.getenv("VERSION")
			from components.java
		}
	}
}
